---
sidebar_position: 1
---

# Create a JavaScript worker

Workers based on JavaScript work out of the box with Wasm Workers Server. The server integrates a JavaScript interpreter compiled into a WebAssembly module. Currently, the interpreter we support is [quickjs](https://bellard.org/quickjs/), although we are working on adding new ones.

## Your first worker

JavaScript workers are based on the [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request) / [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response) objects from the Web Fetch API. Your worker needs to listen to the `fetch` event, that will include a associated `Request` object. The worker function will receive the request and generate a `Response` object to reply to the request.

In this example, the worker will get a request and print all the related information.

1. First, create a new `index.js` file with the following content. It is the minimum code you need to subscribe to the fetch event and return a valid response.

    ```javascript title="./index.js"
    const reply = (request) => {
      return new Response("Hello Wasm!");
    }

    // Subscribe to the Fetch event
    addEventListener("fetch", event => {
      return event.respondWith(reply(event.request));
    });
    ```

1. Now, you can add more content to the `reply` function to show the request information. In addition to that, let's add a response header.

    ```javascript title="./index.js"
    const reply = (request) => {
      // Body response
      const body = `<!DOCTYPE html>
        <body>
        <h1>Hello from Wasm Workers Server</h1>
        <p>Replying to ${request.url}</p>
        <p>Method: ${request.method}</p>
        <p>User Agent: ${request.headers.get("userAgent")}</p>
        <p>Payload: ${request.body || "-"}</p>
        <p>
            This page was generated by a JavaScript file inside WebAssembly
        </p>
        </body>`;

      // Build a new response
      let response = new Response(body);

      // Add a new header
      response.headers.set("x-generated-by", "wasm-workers-server");

      return response;
    }

    // Subscribe to the Fetch event
    addEventListener("fetch", event => {
      return event.respondWith(reply(event.request));
    });
    ```

1. Save the file and run your worker with `wws`. If you didn't download the `wws` server yet, check our [Getting Started](../start.md) guide.

    ```bash
    wws

    ⚙️ Loading routes from: .
    🗺 Detected routes:
    - http://127.0.0.1:8080/
    => index.js (handler: default)
    🚀 Start serving requests at http://127.0.0.1:8080
    ```

1. Finally, open <http://127.0.0.1:8080> in your browser.

## Add a Key / Value store

Wasm Workers allows you to add a Key / Value store to your workers. Read more information about this feature in the [Key / Value store](../features/key-value.md) section.

To add a KV store to your worker, follow these steps:

1. First, create a `counter.js` file. It will access to the KV store through the `Cache` object:

    ```javascript title="./counter.js"
    const CACHE_KEY = "counter";

    const reply = (request) => {
        let counter = Cache.get("counter") || 0;
        counter += 1;

        Cache.set("counter", counter);

        return new Response(`Counter: ${counter}`);
    }

    addEventListener("fetch", event => {
        event.respondWith(reply(event.request));
    });
    ```

1. Create a `counter.toml` file with the following content. Note the name of the TOML file must match the name of the handler. In this case we have `counter.js` and `counter.toml` in the same folder:

    ```toml title="./counter.toml"
    name = "counter"
    version = "1"

    [data]
    [data.kv]
    namespace = "counter"
    ```

1. Save the file and run your worker with `wws`. If you didn't download the `wws` server yet, check our [Getting Started](../start.md) guide.

    ```bash
    wws

    ⚙️ Loading routes from: .
    🗺 Detected routes:
    - http://127.0.0.1:8080/counter
    => counter.js (handler: default)
    🚀 Start serving requests at http://127.0.0.1:8080
    ```

1. Finally, open <http://127.0.0.1:8080/counter> in your browser.

## Other examples

* [Basic](https://github.com/vmware-labs/wasm-workers-server/tree/main/examples/js-basic/handler.js)
* [JSON](https://github.com/vmware-labs/wasm-workers-server/tree/main/examples/js-json/handler.js)
* [Redirect](https://github.com/vmware-labs/wasm-workers-server/tree/main/examples/js-redirect/handler.js)
* [Tic Tac Toe](https://github.com/vmware-labs/wasm-workers-server/tree/main/examples/js-tictactoe/handler.js)